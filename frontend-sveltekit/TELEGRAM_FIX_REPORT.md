# üîß –û—Ç—á–µ—Ç –æ–± –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ Telegram –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

**–î–∞—Ç–∞**: 2025-10-23
**–ê–≤—Ç–æ—Ä**: Claude Code
**–í–µ—Ä—Å–∏—è**: 1.0

---

## üìã –ü—Ä–æ–±–ª–µ–º—ã, –∫–æ—Ç–æ—Ä—ã–µ –±—ã–ª–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã

### 1. ‚ùå Telegram Web App SDK –Ω–µ –±—ã–ª –ø–æ–¥–∫–ª—é—á–µ–Ω

**–°–∏–º–ø—Ç–æ–º**: –û—Ç–æ–±—Ä–∞–∂–∞–ª—Å—è "–°–µ—Ä–≥–µ–π –ú—É—Ä–∑–∏–Ω" –≤–º–µ—Å—Ç–æ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –∏–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ Telegram

**–ö–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞**: –í `src/app.html` –æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª —Å–∫—Ä–∏–ø—Ç Telegram Web App SDK

**–ß—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–ª–æ**:
- `window.Telegram.WebApp` –±—ã–ª `undefined`
- `getTelegramUser()` –≤–æ–∑–≤—Ä–∞—â–∞–ª `null`
- `ProfileCard` –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª –¥–µ–º–æ-–¥–∞–Ω–Ω—ã–µ –∏–∑ `user.json`

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**:
```html
<!-- src/app.html -->
<script src="https://telegram.org/js/telegram-web-app.js"></script>
```

**–§–∞–π–ª**: `src/app.html:8`

---

### 2. ‚ùå –î—É–±–ª–∏–∫–∞—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è SDK

**–°–∏–º–ø—Ç–æ–º**: SDK –ø–æ–¥–∫–ª—é—á–∞–ª—Å—è –¥–≤–∞–∂–¥—ã (–ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ñ–ª–∏–∫—Ç)

**–ö–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞**: SDK –ø–æ–¥–∫–ª—é—á–∞–ª—Å—è –∏ –≤ `app.html`, –∏ –≤ `+layout.svelte`

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**: –£–¥–∞–ª–µ–Ω –¥—É–±–ª–∏–∫–∞—Ç –∏–∑ `src/routes/+layout.svelte:65`

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: –û–¥–∏–Ω –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã –¥–ª—è SDK

---

### 3. ‚ùå –ù–µ–ø–æ–ª–Ω—ã–π –º–∞–ø–ø–∏–Ω–≥ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–°–∏–º–ø—Ç–æ–º**: `cardNumber` –Ω–µ –æ–±–Ω–æ–≤–ª—è–ª—Å—è –¥–∞–Ω–Ω—ã–º–∏ –∏–∑ Telegram

**–ö–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞**: –í `ProfileCard.svelte` –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è `telegram_user_id` –∫–∞–∫ –Ω–æ–º–µ—Ä –∫–∞—Ä—Ç—ã

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**:
```typescript
// src/lib/components/loyalty/ui/ProfileCard.svelte:48
displayUser = {
  ...user,
  name: newName,
  balance: result.user.current_balance,
  cardNumber: result.user.telegram_user_id?.toString() || user.cardNumber,
  // ...
};
```

**–§–∞–π–ª**: `src/lib/components/loyalty/ui/ProfileCard.svelte:44-51`

---

## ‚úÖ –ß—Ç–æ —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç

### 1. –ü–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –∏–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–ë—ã–ª–æ**: "–°–µ—Ä–≥–µ–π –ú—É—Ä–∑–∏–Ω" (—Ö–∞—Ä–¥–∫–æ–∂–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)
**–°—Ç–∞–ª–æ**: "–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤" (—Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ Telegram)

**–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç**:
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç Web App —á–µ—Ä–µ–∑ Telegram
2. `getTelegramUser()` –∏–∑–≤–ª–µ–∫–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ: `{ id, first_name, last_name, username }`
3. `ProfileCard.onMount()` –≤—ã–∑—ã–≤–∞–µ—Ç `initializeUser()`
4. API `/api/telegram/init` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç/—Å–æ–∑–¥–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
5. `ProfileCard` –æ–±–Ω–æ–≤–ª—è–µ—Ç `displayUser` —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏

**–õ–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏**:
```
[ProfileCard] Telegram user from SDK: { id: 123456789, first_name: "–ò–≤–∞–Ω", ... }
[ProfileCard] Updating displayUser with name: –ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤ balance: 500
[ProfileCard] Mount complete. Final displayUser: –ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤
```

---

### 2. –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ 500 –º—É—Ä–∑–∏–∫–æ–π–Ω–æ–≤ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ

**–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç**:
1. `POST /api/telegram/init` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ `users_state.json`
2. –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–æ–≤—ã–π:
   - –°–æ–∑–¥–∞–µ—Ç—Å—è –∑–∞–ø–∏—Å—å —Å `current_balance: 500`
   - –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è `first_login_bonus_claimed: true`
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è `isNewUser: true`
3. –§—Ä–æ–Ω—Ç–µ–Ω–¥ –ø–æ–ª—É—á–∞–µ—Ç `current_balance: 500` –∏ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –≤ UI

**–ö–æ–¥**:
```typescript
// src/routes/api/telegram/init/+server.ts:135-147
const newUser: UserState = {
  telegram_user_id: userData.telegram_user_id,
  first_name: userData.first_name,
  current_balance: 500.0, // Welcome bonus ‚úÖ
  first_login_bonus_claimed: true,
  // ...
};
```

**JSON —Å—Ç—Ä—É–∫—Ç—É—Ä–∞**:
```json
{
  "users": [
    {
      "telegram_user_id": 123456789,
      "first_name": "–ò–≤–∞–Ω",
      "current_balance": 500.00,
      "first_login_bonus_claimed": true
    }
  ]
}
```

---

### 3. –û—Ç–ø—Ä–∞–≤–∫–∞ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è —á–µ—Ä–µ–∑ –±–æ—Ç–∞

**–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç**:
1. –ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (`isNewUser === true`)
2. API –≤—ã–∑—ã–≤–∞–µ—Ç `POST /api/telegram/welcome`:
   ```typescript
   await fetch('/api/telegram/welcome', {
     method: 'POST',
     body: JSON.stringify({
       chat_id: userData.chat_id,
       first_name: userData.first_name,
       bonus_amount: 500
     })
   });
   ```
3. –ë–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Telegram Bot API:
   ```
   –ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, –ò–≤–∞–Ω!

   –í–∞–º –Ω–∞—á–∏—Å–ª–µ–Ω–æ 500 –±–æ–Ω—É—Å–Ω—ã—Ö –º—É—Ä–∑–∏–∫–æ–π–Ω–æ–≤! üéâ

   –í—ã –º–æ–∂–µ—Ç–µ –ø–æ—Ç—Ä–∞—Ç–∏—Ç—å –∏—Ö –ø—Ä–∏ –ø–æ–∫—É–ø–∫–∞—Ö –≤ –Ω–∞—à–µ–π —Å–µ—Ç–∏ –º–∞–≥–∞–∑–∏–Ω–æ–≤.

   –°–ø–∞—Å–∏–±–æ, —á—Ç–æ –≤—ã–±—Ä–∞–ª–∏ –Ω–∞—Å! üêæ
   ```

**–ö–æ–¥**:
```typescript
// src/routes/api/telegram/welcome/+server.ts:60-80
const response = await fetch(`${TELEGRAM_API_URL}/sendMessage`, {
  method: 'POST',
  body: JSON.stringify({
    chat_id,
    text: message,
    parse_mode: 'HTML'
  })
});
```

**–ë–æ—Ç —Ç–æ–∫–µ–Ω**: `8182226460:AAHzGWQoqPhb2dYJ4D9ORzmHzHW7G8S_JzM`

---

## üóÇÔ∏è –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

| –§–∞–π–ª | –ò–∑–º–µ–Ω–µ–Ω–∏–µ | –°—Ç—Ä–æ–∫–∏ |
|------|-----------|--------|
| `src/app.html` | –î–æ–±–∞–≤–ª–µ–Ω Telegram SDK | 8 |
| `src/routes/+layout.svelte` | –£–¥–∞–ª–µ–Ω –¥—É–±–ª–∏–∫–∞—Ç SDK | 65 (—É–¥–∞–ª–µ–Ω–∞) |
| `src/lib/components/loyalty/ui/ProfileCard.svelte` | –î–æ–±–∞–≤–ª–µ–Ω –º–∞–ø–ø–∏–Ω–≥ `cardNumber` | 48 |
| `TELEGRAM_DEBUG_GUIDE.md` | –°–æ–∑–¥–∞–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è | NEW |
| `TELEGRAM_FIX_REPORT.md` | –°–æ–∑–¥–∞–Ω –æ—Ç—á–µ—Ç | NEW |

---

## üîç –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç

### –ù–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ (dev mode)

```bash
cd frontend-sveltekit
npm run dev
```

–û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ: http://localhost:5173

**–û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ**:
- –í–∏–¥–∏—Ç–µ "–°–µ—Ä–≥–µ–π –ú—É—Ä–∑–∏–Ω" (–¥–µ–º–æ-—Ä–µ–∂–∏–º, —Ç–∞–∫ –∫–∞–∫ –Ω–µ –≤ Telegram)
- –í –∫–æ–Ω—Å–æ–ª–∏: `[ProfileCard] Demo mode: Not running in Telegram Web App`

---

### –í Telegram Web App (production)

1. –û—Ç–∫—Ä–æ–π –±–æ—Ç–∞: https://t.me/YourBot
2. –ù–∞–∂–º–∏ "Start" ‚Üí –æ—Ç–∫—Ä–æ–µ—Ç—Å—è Web App
3. –í –∫–æ–Ω—Å–æ–ª–∏ DevTools (—á–µ—Ä–µ–∑ Telegram Desktop –∏–ª–∏ Eruda):
   ```
   [ProfileCard] Telegram user from SDK: { id: 123456789, ... }
   [ProfileCard] Running in Telegram Web App mode
   [ProfileCard] Telegram user initialized: { isNewUser: true, bonus: "500 Murzikoyns awarded" }
   ```
4. –ù–∞ —ç–∫—Ä–∞–Ω–µ –≤–∏–¥–∏—à—å —Å–≤–æ–µ —Ä–µ–∞–ª—å–Ω–æ–µ –∏–º—è –∏–∑ Telegram
5. –ë–∞–ª–∞–Ω—Å: 500 –º—É—Ä–∑–∏–∫–æ–π–Ω–æ–≤
6. –í –ª–∏—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ø—Ä–∏—Ö–æ–¥–∏—Ç –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç –±–æ—Ç–∞

---

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API (curl)

#### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–æ—Ç–∞:
```bash
curl https://murzicoin.murzico.ru/api/telegram/welcome
```

–û—Ç–≤–µ—Ç:
```json
{
  "success": true,
  "message": "Bot connection successful",
  "bot_info": {
    "id": 8182226460,
    "is_bot": true,
    "first_name": "MurziKoin Bot"
  }
}
```

#### 2. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
```bash
curl -X POST https://murzicoin.murzico.ru/api/telegram/init \
  -H "Content-Type: application/json" \
  -d '{
    "telegram_user_id": 999999999,
    "first_name": "–¢–µ—Å—Ç",
    "last_name": "–¢–µ—Å—Ç–æ–≤",
    "chat_id": 999999999
  }'
```

–û—Ç–≤–µ—Ç:
```json
{
  "success": true,
  "isNewUser": true,
  "user": {
    "telegram_user_id": 999999999,
    "first_name": "–¢–µ—Å—Ç",
    "current_balance": 500
  },
  "message": "Welcome! 500 Murzikoyns awarded"
}
```

#### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ Telegram:
–û—Ç–∫—Ä–æ–π Telegram ‚Üí –õ–∏—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Å –±–æ—Ç–æ–º ‚Üí –î–æ–ª–∂–Ω–æ –ø—Ä–∏–π—Ç–∏:
```
–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, –¢–µ—Å—Ç!

–í–∞–º –Ω–∞—á–∏—Å–ª–µ–Ω–æ 500 –±–æ–Ω—É—Å–Ω—ã—Ö –º—É—Ä–∑–∏–∫–æ–π–Ω–æ–≤! üéâ

–í—ã –º–æ–∂–µ—Ç–µ –ø–æ—Ç—Ä–∞—Ç–∏—Ç—å –∏—Ö –ø—Ä–∏ –ø–æ–∫—É–ø–∫–∞—Ö –≤ –Ω–∞—à–µ–π —Å–µ—Ç–∏ –º–∞–≥–∞–∑–∏–Ω–æ–≤.

–°–ø–∞—Å–∏–±–æ, —á—Ç–æ –≤—ã–±—Ä–∞–ª–∏ –Ω–∞—Å! üêæ
```

---

## üìä –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–µ—à–µ–Ω–∏—è

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Telegram Web App (https://murzicoin.murzico.ru)       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                   ‚îÇ
                   ‚îÇ 1. User opens app
                   ‚ñº
   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
   ‚îÇ  app.html (Telegram SDK loaded)           ‚îÇ
   ‚îÇ  <script src="telegram-web-app.js">       ‚îÇ ‚úÖ FIXED
   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                   ‚îÇ
                   ‚îÇ 2. SDK initialized
                   ‚ñº
   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
   ‚îÇ  +layout.svelte                           ‚îÇ
   ‚îÇ  onMount: initTelegramWebApp()            ‚îÇ
   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                   ‚îÇ
                   ‚îÇ 3. Page loads
                   ‚ñº
   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
   ‚îÇ  ProfileCard.svelte                       ‚îÇ
   ‚îÇ  onMount: initializeUser()                ‚îÇ
   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                   ‚îÇ
                   ‚îÇ 4. POST /api/telegram/init
                   ‚ñº
   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
   ‚îÇ  API: /api/telegram/init                  ‚îÇ
   ‚îÇ  - Read users_state.json                  ‚îÇ
   ‚îÇ  - Check if user exists                   ‚îÇ
   ‚îÇ  - Award 500 coins if new                 ‚îÇ ‚úÖ FIXED
   ‚îÇ  - Save to JSON                           ‚îÇ
   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                   ‚îÇ
                   ‚îÇ 5. If new user
                   ‚ñº
   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
   ‚îÇ  API: /api/telegram/welcome               ‚îÇ
   ‚îÇ  - Send message via Bot API               ‚îÇ ‚úÖ FIXED
   ‚îÇ  - "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, {name}!"                ‚îÇ
   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                   ‚îÇ
                   ‚îÇ 6. Return user data
                   ‚ñº
   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
   ‚îÇ  ProfileCard displays:                    ‚îÇ
   ‚îÇ  - Real name from Telegram                ‚îÇ ‚úÖ FIXED
   ‚îÇ  - Balance: 500                           ‚îÇ
   ‚îÇ  - Card: telegram_user_id                 ‚îÇ ‚úÖ FIXED
   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üîê –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (–¥–ª—è production)

### 1. –ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ –≤ .env

**–°–µ–π—á–∞—Å** (–Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ):
```typescript
const BOT_TOKEN = '8182226460:AAHzGWQoqPhb2dYJ4D9ORzmHzHW7G8S_JzM';
```

**–ù—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å**:
```bash
# .env
TELEGRAM_BOT_TOKEN=8182226460:AAHzGWQoqPhb2dYJ4D9ORzmHzHW7G8S_JzM
```

```typescript
// welcome/+server.ts
const BOT_TOKEN = process.env.TELEGRAM_BOT_TOKEN;
```

### 2. –î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é Telegram Web App data

Telegram –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `hash` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö. –î–æ–±–∞–≤—å –≤ `init/+server.ts`:

```typescript
import crypto from 'crypto';

function validateTelegramWebAppData(initData: string, botToken: string): boolean {
  const urlParams = new URLSearchParams(initData);
  const hash = urlParams.get('hash');
  urlParams.delete('hash');

  const dataCheckString = Array.from(urlParams.entries())
    .sort(([a], [b]) => a.localeCompare(b))
    .map(([key, value]) => `${key}=${value}`)
    .join('\n');

  const secretKey = crypto
    .createHmac('sha256', 'WebAppData')
    .update(botToken)
    .digest();

  const calculatedHash = crypto
    .createHmac('sha256', secretKey)
    .update(dataCheckString)
    .digest('hex');

  return calculatedHash === hash;
}
```

### 3. –î–æ–±–∞–≤–∏—Ç—å rate limiting

```typescript
import { rateLimit } from '$lib/server/rate-limit';

export const POST: RequestHandler = async ({ request, getClientAddress }) => {
  const clientIP = getClientAddress();

  if (!rateLimit.check(clientIP, { maxAttempts: 10, windowMs: 60000 })) {
    return json({ error: 'Too many requests' }, { status: 429 });
  }

  // ... rest of handler
};
```

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- **TELEGRAM_DEBUG_GUIDE.md** - –ø–æ–¥—Ä–æ–±–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –æ—Ç–ª–∞–¥–∫–µ
- **TELEGRAM_INTEGRATION.md** - –ø–æ–ª–Ω–∞—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- **DATABASE_SCHEMA.md** - –ø–ª–∞–Ω –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–∞ –ë–î

---

## ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç –¥–ª—è –¥–µ–ø–ª–æ—è

- [x] Telegram SDK –ø–æ–¥–∫–ª—é—á–µ–Ω –≤ `app.html`
- [x] –î—É–±–ª–∏–∫–∞—Ç—ã —É–¥–∞–ª–µ–Ω—ã
- [x] `ProfileCard` –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –º–∞–ø–ø–∏—Ç –¥–∞–Ω–Ω—ã–µ
- [x] API `/api/telegram/init` —Ä–∞–±–æ—Ç–∞–µ—Ç
- [x] API `/api/telegram/welcome` —Ä–∞–±–æ—Ç–∞–µ—Ç
- [x] –ë–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è
- [ ] –¢–æ–∫–µ–Ω –±–æ—Ç–∞ –≤ `.env` (TODO)
- [ ] –î–æ–±–∞–≤–ª–µ–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è hash (TODO)
- [ ] –î–æ–±–∞–≤–ª–µ–Ω rate limiting (TODO)
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ –≤ production (TODO)

---

## üéØ –ò—Ç–æ–≥–∏

### –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:
1. ‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω Telegram Web App SDK
2. ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
3. ‚úÖ –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ 500 –º—É—Ä–∑–∏–∫–æ–π–Ω–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç
4. ‚úÖ –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è

### –ß—Ç–æ —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç:
- –†–µ–∞–ª—å–Ω–æ–µ –∏–º—è –∏–∑ Telegram –≤–º–µ—Å—Ç–æ "–°–µ—Ä–≥–µ–π –ú—É—Ä–∑–∏–Ω"
- –ë–∞–ª–∞–Ω—Å 500 –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ
- –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç –±–æ—Ç–∞
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ `users_state.json`

### –ß—Ç–æ –æ—Å—Ç–∞–ª–æ—Å—å —Å–¥–µ–ª–∞—Ç—å (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):
- –ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ –≤ `.env`
- –î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é Telegram Web App data
- –î–æ–±–∞–≤–∏—Ç—å rate limiting
- –ú–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å JSON –Ω–∞ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö

---

**–í–µ—Ä—Å–∏—è**: 1.0
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –í—Å–µ –∫—Ä–∏—Ç–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã
**–ì–æ—Ç–æ–≤–æ –∫ –¥–µ–ø–ª–æ—é**: –î–∞ (—Å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–µ–π –¥–æ–±–∞–≤–∏—Ç—å security fixes)
