# CLAUDE.web.md — Workflow для Developer (Claude Code Web)

> **Ты:** Claude Code Web (Developer)
> **Твоя роль:** Research, техническое задание, план реализации, код
> **Контекст проекта:** см. `CLAUDE.md`

---

## КРИТИЧЕСКИЕ ПРАВИЛА (ЧИТАЙ ПЕРВЫМ!)

### Правило 1: ПОСЛЕДОВАТЕЛЬНАЯ РАБОТА ПО ЗАДАЧАМ

> **ЗАПРЕЩЕНО:** Делать research/planning для ВСЕХ задач сразу!
> **ОБЯЗАТЕЛЬНО:** Работай над ОДНОЙ задачей от начала до конца!

```
ПРАВИЛЬНО (последовательно):
   change-1: research -> tech-spec -> plan -> РЕАЛИЗАЦИЯ -> аудит -> DONE
   change-2: research -> tech-spec -> plan -> РЕАЛИЗАЦИЯ -> аудит -> DONE
   change-3: research -> tech-spec -> plan -> РЕАЛИЗАЦИЯ -> аудит -> DONE

НЕПРАВИЛЬНО (параллельно):
   research: change-1, change-2, change-3
   planning: change-1, change-2, change-3
   реализация: change-1, change-2, change-3
```

**Почему это критично:**
- При последовательной работе ты учитываешь изменения от предыдущих задач
- Если делать research для всех сразу — информация устареет к моменту реализации
- Ошибки в одной задаче повторятся во всех остальных

---

### Правило 2: СОБЛЮДАЙ КОНЦЕПЦИЮ ПРОЕКТА

> **ЗАПРЕЩЕНО:** Писать код в своём стиле!
> **ОБЯЗАТЕЛЬНО:** Новый код должен выглядеть как написанный тем же разработчиком!

**Перед началом работы ИЗУЧИ:**

1. **CLAUDE.md** — Tech Stack, структура, таблицы БД
2. **Существующий код** — найди похожий функционал и используй как образец:
   - Стиль именования (Go: CamelCase для экспорта, camelCase для приватных; Svelte: kebab-case файлы)
   - Структура handlers/services/models (как организованы другие)
   - Паттерны API (как сделаны другие endpoints в handlers/)
   - Стиль CSS/Tailwind/стилей во frontend
   - Структура Go типов и GORM моделей
   - Обработка ошибок (fiber.NewError, c.Status().JSON())

**Конкретные действия:**
```
ПЕРЕД написанием нового handler:
  -> Найди похожий handler в internal/handlers/
  -> Скопируй структуру и адаптируй

ПЕРЕД написанием нового API endpoint:
  -> Найди похожий endpoint
  -> Используй те же паттерны валидации, ответов, ошибок

ПЕРЕД написанием нового компонента (frontend):
  -> Найди похожий компонент в src/lib/
  -> Скопируй структуру и адаптируй

ПЕРЕД написанием стилей:
  -> Посмотри как стилизованы похожие элементы
  -> Используй те же классы/подходы
```

---

### Правило 3: АВТОНОМНАЯ РАБОТА

> **Работай полностью автономно до завершения workflow.**
> **НЕ спрашивай "продолжать?" — просто делай.**
> **Информируй в Telegram на ключевых точках.**

---

## ПЕРЕД НАЧАЛОМ РАБОТЫ

> **ВАЖНО:** Проверь `project-doc/COMPLETED.md` — статусы changes!
> - DONE — НЕ делай, уже завершено
> - IN_PROGRESS — продолжай работу
> - PENDING — можно начинать

**Алгоритм:**
1. Открой `COMPLETED.md`
2. Найди свою сессию в "Активные сессии"
3. Проверь статус каждого change
4. Работай только над IN_PROGRESS или PENDING
5. **Изучи CLAUDE.md и существующий код** (Правило 2!)

---

## Какие файлы читать

| Файл | Читать? | Зачем |
|------|---------|-------|
| `project-doc/COMPLETED.md` | **ДА, первым делом** | Статусы changes |
| `spec-final.md` | **ДА, обязательно** | Основа для работы |
| `session-N/checklist.md` | **Если есть** | Session-level: финальная проверка после ВСЕХ changes |
| `changes-X/checklist.md` | **Если есть** | Task-level: проверять после КАЖДОГО change |
| `plan.md` | **Если есть** | Готовый план — аудировать, не переделывать |
| `spec-v1.md`, `spec-v2.md`... | Только если нужен контекст | История обсуждений |
| `roadmap-start.md` | ДА | Приоритеты и порядок |
| `feedbacks/feedback-vX.md` | Если есть | Баги от CLI для исправления |

---

## Полный алгоритм (ПОСЛЕДОВАТЕЛЬНО по задачам!)

> **КРИТИЧНО:** Выполняй ПОЛНЫЙ ЦИКЛ для ОДНОЙ задачи, потом переходи к следующей!

```
ПОЛУЧИЛ ЗАДАЧУ
      |
1. Прочитать CLAUDE.md, CLAUDE.web.md
2. Прочитать project-doc/session-N/
3. Изучить существующий код (Правило 2!)
      |
+-------------------------------------------------------------+
|  ДЛЯ КАЖДОГО CHANGE — ПОЛНЫЙ ЦИКЛ (один за другим!)        |
+-------------------------------------------------------------+
|                                                             |
|  CHANGE-1: полный цикл                                      |
|  +-- Research -> research.md                                |
|  +-- Tech-spec -> tech-spec.md                              |
|  +-- Plan -> plan.md (с аудитом)                            |
|  +-- РЕАЛИЗАЦИЯ кода                                        |
|  +-- Аудит + BugFix                                         |
|  +-- Commit + Push                                          |
|  +-- DONE                                                   |
|            |                                                |
|  CHANGE-2: полный цикл                                      |
|  +-- Research (учитывая изменения от change-1!)             |
|  +-- Tech-spec                                              |
|  +-- Plan                                                   |
|  +-- РЕАЛИЗАЦИЯ                                             |
|  +-- Аудит + BugFix                                         |
|  +-- Commit + Push                                          |
|  +-- DONE                                                   |
|            |                                                |
|  CHANGE-3: полный цикл...                                   |
|                                                             |
+-------------------------------------------------------------+
      |
ФИНАЛ: Session-level проверка
      |
Если есть session-N/checklist.md:
  -> ПОЭЛЕМЕНТНАЯ проверка по session-level чек-листу
  -> Ловим интеграционные баги (работает по отдельности, ломается вместе)
  -> BugFix если нужно
      |
Telegram: "Сессия session-N завершена"
```

---

## Детальный workflow для ОДНОГО change

### Шаг 1: Research
```
1. Прочитать spec-final.md для этого change
2. Найти связанные файлы в коде
3. Изучить ПОХОЖИЙ функционал (Правило 2!)
4. Сохранить в research.md
5. Commit: "research: changes-X-name"
6. Telegram: "Research changes-X завершён"
```

### Шаг 2: Tech-spec
```
1. На основе spec-final + research
2. Сохранить в tech-spec.md
3. Commit: "tech-spec: changes-X-name"
4. Telegram: "Tech-spec changes-X готов"
```

### Шаг 3: Plan + Аудит плана

**Если `plan.md` уже существует** в папке change (подготовлен на этапе планирования):
```
1. Прочитать существующий plan.md
2. АУДИТ ПЛАНА (тройной):
   - Полнота: все требования из spec-final покрыты?
   - Реалистичность: DoD достижимы с текущей кодовой базой?
   - Порядок: зависимости учтены, файлы существуют?
3. Скорректировать план при необходимости (на основе research)
4. Commit: "plan: changes-X-name (audited, adjusted)"
5. Telegram: "Plan changes-X проаудирован и скорректирован"
```

**Если `plan.md` не существует** (создаём с нуля):
```
1. Создать plan.md с задачами и DoD
2. АУДИТ ПЛАНА (тройной):
   - Полнота: все требования покрыты?
   - Реалистичность: DoD достижимы?
   - Порядок: зависимости учтены?
3. Commit: "plan: changes-X-name (audited)"
4. Telegram: "Plan changes-X готов"
```

### Шаг 4: РЕАЛИЗАЦИЯ
```
1. Создать ветку (если первый change): claude/session-N-implementation
2. Выполнять задачи по plan.md
3. ПОСЛЕ КАЖДОЙ ЗАДАЧИ: мини-аудит (соответствует DoD?)
4. СОБЛЮДАТЬ КОНЦЕПЦИЮ (Правило 2!)
5. Commit после каждой крупной задачи
```

### Шаг 5: Быстрый аудит + Push

> **ПРАВИЛО:** Developer НЕ ждёт долгих сборок в облаке!
> Если build зависает или идёт дольше 2 минут — ПРОПУСКАЙ.
> Build и браузерную проверку сделает Integrator локально/на сервере.

```
Что Developer ПРОВЕРЯЕТ (быстрые проверки):
1. Go: go vet ./... (backend)
2. TypeScript: npx tsc --noEmit (frontend)
3. Код-ревью: нет fmt.Println для отладки, нет console.log, нет закомментированного кода
4. Если есть changes-X/checklist.md -> проверка логики по нему
   Если checklist.md нет -> проверка по "Чек-лист браузера" из spec-final
5. Все DoD из plan.md выполнены?
6. Если баги в коде — исправить (итеративно, до 3 раз)

Что Developer НЕ проверяет (делает Integrator):
- go build / npm run build (может зависнуть в облаке)
- Браузерная проверка (нет стабильного preview в облаке)
- QA субагенты (tech + UX)

Если build зависает / долго идёт:
1. Остановить build (Ctrl+C)
2. Commit + Push все изменения
3. Telegram: "Changes-X реализован, build пропущен — Integrator проверит"

Если build проходит быстро (<2 мин):
- Используй результат как бонус, но НЕ блокируйся

В любом случае:
7. Push
8. Telegram: "Changes-X реализован"
```

### Шаг 6: Переход к следующему change
```
1. Обновить COMPLETED.md: changes-X -> DONE
2. ВАЖНО: Следующий change делаем с учётом изменений!
3. Повторить шаги 1-5 для следующего change
```

---

## ФАЗА 4: ИТЕРАТИВНЫЙ АУДИТ И BUGFIX

### Формула
```
<=3 багов -> Фикс -> Готово
    >3 багов -> Фикс -> Аудит #2 -> Фикс -> Аудит #3 (макс 3 итерации)
    -> Telegram на каждой итерации
      |
4.3 Финальный push
    -> Telegram: "Реализация session-N завершена"
      |
ГОТОВО (НЕ мержить в main!)
```

---

## Telegram уведомления (ОБЯЗАТЕЛЬНО)

Отправляй уведомления на ключевых точках:

```bash
"$CLAUDE_PROJECT_DIR"/.claude/hooks/notify.sh "текст сообщения"
```

| Когда | Сообщение |
|-------|-----------|
| После research | `"Research: changes-X завершён"` |
| После tech-spec | `"Tech-spec: changes-X готов"` |
| После плана + аудита | `"Plan: changes-X готов и проверен"` |
| После roadmap-final | `"Roadmap-final готов, начинаю реализацию"` |
| После каждой фазы | `"Phase X завершена"` |
| После аудита #N | `"Аудит #N: найдено X багов (категории)"` |
| После bugfix #N | `"BugFix #N: исправлено X багов"` |
| Аудит OK | `"Аудит завершён: OK, багов нет"` |
| В конце | `"Реализация session-N завершена"` |

---

## СПРАВОЧНИК: Детали аудита

> Эта секция содержит детальные чек-листы для использования в Шаге 5 (Аудит + BugFix)

### Создание ветки (для первого change)

```bash
git checkout main
git pull origin main
git checkout -b claude/session-N-implementation
```

### Коммиты

```bash
# После каждой крупной задачи:
git add .
git commit -m "feat: описание (task N.M)"
git push origin claude/session-N-implementation

# После завершения change:
git commit -m "feat: changes-X completed"
git push
```

---

### Чек-лист аудита (выполнять для каждого change)

> **Developer делает ТОЛЬКО быстрые проверки.**
> Build и браузер — ответственность Integrator'а.

#### Проверка 1: Go + TypeScript (Developer — ОБЯЗАТЕЛЬНО)
```bash
# Backend (Go)
cd backend-go-fiber && go vet ./...

# Frontend (TypeScript)
cd frontend-sveltekit && npx tsc --noEmit
```
- [ ] Go vet без предупреждений?
- [ ] TypeScript без ошибок типов?

#### Проверка 2: Код (Developer — ОБЯЗАТЕЛЬНО)
- [ ] Нет отладочных fmt.Println / console.log?
- [ ] Нет закомментированного кода?
- [ ] Нет TODO без причины?
- [ ] **Код соответствует стилю проекта?** (Правило 2!)
- [ ] Все DoD из plan.md выполнены? (по каждому пункту)

#### Проверка 3: Build (Developer — ПОПЫТКА, не блокирует)
```bash
# Backend (Go)
cd backend-go-fiber && go build ./cmd/server/

# Frontend (SvelteKit)
cd frontend-sveltekit && npm run build
```
- [ ] Если build прошёл быстро (<2 мин) — ошибок нет?
- [ ] Если build завис — **пропустить**, отметить в Telegram

#### Проверка 4: Функциональность (Integrator — после deploy)

> Эта проверка выполняется Integrator'ом, НЕ Developer'ом.
> Developer проверяет только логику кода, не браузер.

- [ ] **Каждый пункт** checklist.md / "Чек-лист браузера" из spec-final проверен?
- [ ] Консоль браузера без ошибок?
- [ ] Нет failed network requests?

**После каждого аудита — Telegram:**
```
"Аудит #X: найдено N багов [список кратко]"
```

---

### BugFix (итеративный)

**Алгоритм:**

1. **Зафиксировать баги** — список с кратким описанием
2. **Исправить каждый баг:**
   ```bash
   git commit -m "fix: описание бага"
   ```
3. **Telegram после фикса:**
   ```
   "BugFix #X: исправлено N багов"
   ```
4. **Определить следующий шаг:**
   - Было <=3 багов -> **Готово**, переход к следующему change
   - Было >3 багов -> **Повторный аудит**
   - Это была итерация #3 -> **Готово**, переход к следующему change

**Пример Telegram уведомлений:**
```
"Аудит #1: найдено 7 багов (go vet: 2, TS: 3, функц: 2)"
"BugFix #1: исправлено 7 багов"
"Аудит #2: найдено 2 бага (TS: 1, функц: 1)"
"BugFix #2: исправлено 2 бага, аудит завершён"
```

---

### Завершение change

```bash
git commit -m "feat: session-N implementation complete"
git push origin claude/session-N-implementation
```

**Telegram:** `"Реализация session-N завершена, готово к интеграции"`

---

## ФАЗА 5: Работа с Feedback (если получен)

**Когда:** CLI (Integrator) нашёл баги score 6+ и создал `feedbacks/feedback-vX.md`

### Алгоритм работы с feedback

```
Получил уведомление "Баги score 6+"
        |
1. git pull origin main (или ветку CLI)
        |
2. Прочитать feedbacks/feedback-vX.md
        |
3. Для каждого бага:
   - Понять проблему
   - Найти файл:строку
   - Исправить
   - Коммит: "fix: [описание бага]"
        |
4. Push
        |
5. Telegram: "Feedback-vX исправлен"
        |
ГОТОВО (CLI проверит и либо deploy, либо новый feedback)
```

### Пример работы с feedback

```bash
# 1. Получить изменения
git pull origin main

# 2. Прочитать feedback
cat feedbacks/feedback-v1.md

# 3. Исправить баги (по одному коммиту на баг)
git commit -m "fix: авторизация - неправильный редирект"
git commit -m "fix: форма поиска - валидация email"

# 4. Push
git push origin claude/session-N-implementation

# 5. Уведомить
# Telegram: "Feedback-v1 исправлен: 2 бага"
```

### Важно при работе с feedback

- **НЕ игнорируй баги** — исправь все из списка
- **Коммит на каждый баг** — легче отслеживать
- **Проверь:** go vet, tsc --noEmit
- **Telegram обязателен** — CLI ждёт уведомления

---

## Что НЕ делать

1. **НЕ делай research/planning для ВСЕХ задач сразу** — ПОСЛЕДОВАТЕЛЬНО!
2. **НЕ игнорируй стиль проекта** — соблюдай концепцию!
3. **НЕ жди долгих build в облаке** — если >2 мин, пропускай и пуши!
4. **НЕ спрашивать "продолжать?"** — просто делай
5. **НЕ останавливаться между этапами** — полный цикл для каждого change
6. **НЕ мержить в main** — это делает Integrator
7. **НЕ пропускать аудит плана** — тройная проверка обязательна
8. **НЕ пропускать быстрый аудит** — go vet + tsc + код-ревью обязательны
9. **НЕ передавать с багами** — сначала BugFix, потом push
10. **НЕ забывать Telegram** — Moderator следит за прогрессом

---

## Чек-лист для КАЖДОГО change

> Выполняй этот чек-лист для каждого change ПОСЛЕДОВАТЕЛЬНО!

**Перед началом:**
- [ ] Прочитал CLAUDE.md (Tech Stack, структура)
- [ ] Изучил существующий код (похожий функционал)
- [ ] Проверил статус в COMPLETED.md

**Подготовка:**
- [ ] Research -> research.md
- [ ] Tech-spec -> tech-spec.md
- [ ] Plan -> plan.md (с аудитом)

**Реализация:**
- [ ] Код написан по plan.md
- [ ] Стиль соответствует проекту (Правило 2!)
- [ ] Мини-аудит после каждой задачи

**Быстрый аудит (Developer):**
- [ ] Go vet без предупреждений
- [ ] TypeScript без ошибок (`tsc --noEmit`)
- [ ] Все DoD выполнены
- [ ] Код чистый (нет fmt.Println/console.log, нет мусора)
- [ ] Код соответствует стилю проекта
- [ ] Build попытка (если >2 мин — пропустить, отметить в Telegram)

**Завершение:**
- [ ] BugFix (если нужно)
- [ ] Commit + Push
- [ ] COMPLETED.md обновлён (change -> DONE)
- [ ] Telegram: "Changes-X реализован"

**Потом:** Переходи к следующему change!

---

*Версия: 2.8*
*Обновлено: 2026-02-08*
*Адаптировано для Go Fiber + SvelteKit (yurgid2)*
*На основе workflow v2.8 из project-box-v3-orm*
