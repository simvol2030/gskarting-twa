# Чек-лист: Session 1 — Core Booking System

**Источник:** PRD системы онлайн-бронирования заездов
**Дата:** 2026-02-10

---

## Обзор

Session 1 — фундамент системы бронирования. Создаём БД, backend API и клиентский виджет бронирования. Виджет **универсальный**: работает и как компонент на главной TWA (под сторисами), и как standalone-страница для iframe-встраивания на внешние сайты. Ключевой user flow: клиент выбирает дату, тип, слот, заполняет данные, получает номер брони. Несколько групп могут записаться в один слот (до 8 мест).

---

## Проверка кода (Developer)

- [ ] **T-001** `npm run build` — backend без ошибок
- [ ] **T-002** `npm run build` — frontend без ошибок
- [ ] **T-003** `npx tsc --noEmit` — типы корректны (backend + frontend)
- [ ] **T-004** Нет отладочного кода (console.log, TODO)
- [ ] **T-005** Drizzle миграция создана и применяется без ошибок
- [ ] **T-006** Все новые API endpoints доступны и не конфликтуют с существующими

---

## Проверка в браузере — TWA виджет (на главной)

> **Суть:** Виджет бронирования размещён на главной странице TWA ПОД блоком сторис.
> Пользователь скроллит вниз и видит секцию бронирования. Весь flow должен работать
> без перехода на другие страницы — всё внутри виджета.

### Визуал

- [ ] **F-001** На главной TWA виден блок бронирования под сторисами | CRITICAL
- [ ] **F-002** Dark racing theme: чёрный фон, красные акценты, шрифты Unbounded + Inter | HIGH
- [ ] **F-003** Виджет вписывается в существующий дизайн TWA | HIGH
- [ ] **F-004** Адаптивность: виджет корректно отображается на мобильном (TWA = мобильное устройство) | CRITICAL

### Шаг 1: Выбор даты

- [ ] **F-010** Отображается календарь с текущим месяцем | HIGH
- [ ] **F-011** Индикация загруженности дней (много мест / мало / нет) | MEDIUM
- [ ] **F-012** Прошедшие даты неактивны (нельзя выбрать) | HIGH
- [ ] **F-013** Можно листать на 3 месяца вперёд, но не дальше | MEDIUM
- [ ] **F-014** Клик на дату — переход к выбору времени | CRITICAL

### Шаг 2: Выбор типа и времени

- [ ] **F-020** Toggle: Взрослые / Дети | HIGH
- [ ] **F-021** Сетка доступных слотов с количеством свободных мест | CRITICAL
- [ ] **F-022** Занятые слоты (0 мест) отображаются, но недоступны для выбора | HIGH
- [ ] **F-023** Клик на слот — переход к деталям | CRITICAL

### Шаг 3: Детали бронирования

- [ ] **F-030** Выбор длительности: 10 / 15 / 20 мин | HIGH
- [ ] **F-031** Ввод количества участников (ограничен свободными местами в слоте) | CRITICAL
- [ ] **F-032** Поля: имя (обязательно), телефон (обязательно), email (опционально), комментарий (опционально) | HIGH
- [ ] **F-033** Чекбокс правил | MEDIUM
- [ ] **F-034** Чекбокс согласия на возможное смещение времени | MEDIUM
- [ ] **F-035** Расчёт стоимости отображается (информационно) | HIGH
- [ ] **F-036** Групповая скидка применяется при >= 5 участниках | MEDIUM
- [ ] **F-037** Валидация: обязательные поля подсвечиваются при попытке продолжить | HIGH

### Шаг 4-5: Подтверждение и успех

- [ ] **F-040** Сводка бронирования: дата, время, тип, участники, стоимость | HIGH
- [ ] **F-041** Кнопка "Подтвердить бронь" — создание бронирования | CRITICAL
- [ ] **F-042** Экран успеха: номер брони, дата, время, "приезжайте за 15 минут" | HIGH
- [ ] **F-043** После создания — слот обновляет количество свободных мест | CRITICAL

---

## Проверка в браузере — Standalone виджет

> **Суть:** Тот же виджет бронирования, но как отдельная страница,
> пригодная для встраивания в iframe на внешних сайтах.
> Должен работать автономно, без контекста TWA.

- [ ] **S-001** Standalone-страница открывается по отдельному URL | CRITICAL
- [ ] **S-002** Полный flow бронирования работает (дата — время — детали — подтверждение — успех) | CRITICAL
- [ ] **S-003** Нет зависимости от Telegram WebApp SDK (работает в обычном браузере) | CRITICAL
- [ ] **S-004** Dark racing theme сохраняется | HIGH
- [ ] **S-005** Адаптивность: desktop + tablet + mobile | HIGH
- [ ] **S-006** Iframe-встраивание работает (можно открыть через iframe на тестовой странице) | HIGH

---

## Проверка API

> **Суть:** Backend endpoints корректно работают, данные сохраняются в БД,
> конкурентные бронирования обрабатываются правильно.

- [ ] **A-001** GET /api/booking/config — возвращает конфигурацию | HIGH
- [ ] **A-002** GET /api/booking/schedule/:date — возвращает слоты на день | CRITICAL
- [ ] **A-003** GET /api/booking/schedule/range?from=&to= — загруженность дат | HIGH
- [ ] **A-004** POST /api/booking/bookings — создание брони | CRITICAL
- [ ] **A-005** GET /api/booking/bookings/:id — получение брони по ID | HIGH
- [ ] **A-006** POST /api/booking/bookings/:id/cancel — отмена брони | HIGH
- [ ] **A-007** POST /api/booking/calculate-price — расчёт стоимости | HIGH
- [ ] **A-008** Race condition: два клиента бронируют последнее место одновременно — один получает ошибку | CRITICAL
- [ ] **A-009** Telegram initData валидация для TWA-броней | HIGH

---

## Edge Cases

> **Суть:** Граничные ситуации при реальном использовании.

- [ ] **E-001** День без слотов (выходной) — показывается соответствующее сообщение | MEDIUM
- [ ] **E-002** Все слоты заняты на выбранную дату — календарь показывает "нет мест" | MEDIUM
- [ ] **E-003** Слот заполняется пока клиент заполняет форму — ошибка при отправке с понятным сообщением | HIGH
- [ ] **E-004** Медленная сеть — loading states отображаются | MEDIUM
- [ ] **E-005** Попытка забронировать 9+ участников (больше вместимости) — валидация не пускает | HIGH

---

## Статистика

- Проверка кода: 6
- TWA виджет: 20
- Standalone виджет: 6
- API: 9
- Edge cases: 5
- **Всего: 46 проверок**
