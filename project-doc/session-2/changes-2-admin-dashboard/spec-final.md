# Спецификация: Admin Dashboard + Timeline View + Хронометраж

**Версия:** final
**Change:** changes-2-admin-dashboard
**Session:** session-2
**Зависимости:** changes-1-admin-api

---

## Есть сейчас vs Должно быть

| Аспект | Есть | Должно быть |
|--------|------|-------------|
| Раздел бронирований в админке | Нет | Пункт "Бронирования" в sidebar |
| Dashboard | Нет | Визуальный дашборд со статистикой и Timeline |
| Timeline View | Нет | Горизонтальная шкала заездов на день (desktop), вертикальная (mobile) |
| Хронометраж | Нет | Текущий заезд + обратный отсчёт в реальном времени |
| Статистика | Нет | Карточки: бронирования / участники / выручка / загрузка % |

---

## Что на выходе

1. Пункт "Бронирования" в сайдбаре существующей админки
2. Страница Dashboard с Timeline View
3. Карточки статистики
4. Хронометраж с обратным отсчётом (обновление каждую секунду)
5. Responsive: полноценная работа на desktop и mobile (375px)

---

## Timeline View — Desktop

**Визуал:**
- Горизонтальная шкала времени (11:00 — 22:00, берётся из booking_config.working_hours)
- Слоты как блоки на шкале (пропорционально длительности)
- Цвета блоков по статусу:
  - `available` — тёмно-серый
  - `limited` — жёлтый/оранжевый
  - `booked` — красный (GS Racing accent)
  - `blocked` — зачёркнутый/серый с иконкой замка
- Бронирования внутри слота: мини-карточки с именами/группами
- Красная вертикальная линия = текущее время (animated, обновляется)
- Текущий слот выделен рамкой или подсветкой

**Статистика (карточки над Timeline):**
- Бронирований сегодня: N
- Участников: N
- Выручка: N руб
- Загрузка: N% (занятые места / общие места)

**Выбор даты:** datepicker над Timeline, по умолчанию = сегодня

---

## Timeline View — Mobile (375px)

**Адаптация:**
- Вертикальный список слотов (вместо горизонтальной шкалы)
- Каждый слот — карточка с информацией:
  - Время (start - end)
  - Тип (взрослые/дети)
  - Заполненность (N/8 мест)
  - Статус (цветовая метка)
- Текущий слот вверху с выделением
- Статистика: 2x2 сетка компактных карточек
- Touch targets >= 44px

---

## Хронометраж

- Блок над или рядом с Timeline
- Текст: "Идёт заезд N, осталось X мин Y сек"
- Текст: "Следующий заезд через X мин"
- Обратный отсчёт обновляется каждую секунду (setInterval на клиенте)
- Определяет текущий слот по `start_time` / `end_time` и `new Date()`
- Если нет активного заезда — "Следующий через X мин" или "Нет запланированных заездов"
- Красная линия на Timeline: position пропорционально текущему времени

---

## Навигация

Добавить в sidebar `(admin)/+layout@.svelte`:
- Иконка + текст "Бронирования"
- URL: `/admin/bookings` (или `/bookings` внутри `(admin)/`)
- Позиция: логически между "Заказы" и "Статистика" (или вверху группы)

---

## Файлы (ориентировочные)

| Файл | Описание |
|------|----------|
| `frontend-sveltekit/src/routes/(admin)/bookings/+page.svelte` | Страница дашборда |
| `frontend-sveltekit/src/routes/(admin)/bookings/+page.server.ts` | Server load (fetch dashboard data) |
| `frontend-sveltekit/src/lib/components/admin/booking/TimelineView.svelte` | Timeline (desktop) |
| `frontend-sveltekit/src/lib/components/admin/booking/TimelineViewMobile.svelte` | Timeline (mobile) |
| `frontend-sveltekit/src/lib/components/admin/booking/StatsCards.svelte` | Карточки статистики |
| `frontend-sveltekit/src/lib/components/admin/booking/Chronometer.svelte` | Хронометраж |

> Пути ориентировочные. Developer адаптирует под реальную структуру.

---

## Факторы реализации

- Изучить существующий sidebar — навигация в `(admin)/+layout@.svelte` (строки 58-137)
- Слоты в Timeline кликабельны — открывают детали (модальное окно или боковая панель)
- Dark theme уже используется в существующей админке — согласовать стили
- Хронометраж: setInterval на клиенте, обновление каждую секунду, cleanup в onDestroy
- Данные с API: `GET /api/admin/booking/dashboard?date=YYYY-MM-DD`
- Выбор даты → re-fetch данных → обновление Timeline + статистики

---

## Критерии успеха

- [ ] Dashboard отображает Timeline и статистику за день
- [ ] Хронометраж показывает текущий заезд и обратный отсчёт
- [ ] Timeline отображает все слоты дня с бронированиями
- [ ] Красная линия текущего времени на Timeline
- [ ] Смена даты обновляет все данные
- [ ] Responsive: desktop + mobile (375px)
- [ ] Пункт "Бронирования" в сайдбаре
- [ ] `npm run build` без ошибок

---

## Чек-лист браузера

- [ ] D-001..D-008 (Desktop)
- [ ] D-020..D-023 (Mobile)
